---
interface Props {
  title: string;
  description?: string;
}

const { title, description = "Portfolio de développeur - Étudiant en Informatique" } = Astro.props;
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Theme initialization script - must run before body renders to prevent flash -->
    <script is:inline>
      (function() {
        const getTheme = () => {
          // Check localStorage first
          const storedTheme = localStorage.getItem('theme');
          if (storedTheme) return storedTheme;
          
          // Fall back to system preference
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark';
          }
          
          return 'light';
        };
        
        // Apply theme immediately
        const theme = getTheme();
        document.documentElement.setAttribute('data-theme', theme);
        
        // Listen for system theme changes
        if (window.matchMedia) {
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            // Only apply if user hasn't set a preference
            if (!localStorage.getItem('theme')) {
              document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
          });
        }
      })();
    </script>
  </head>
  <body>
    <slot />
  </body>
</html>

<style is:global>
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  :root {
    /* Light mode colors (default) */
    --color-black: #0a0a0a;
    --color-dark: #1a1a1a;
    --color-gray-dark: #333333;
    --color-gray: #666666;
    --color-gray-light: #999999;
    --color-gray-lighter: #e5e5e5;
    --color-white: #f8f8f7;
    --color-pure-white: #ffffff;

    /* Theme-aware colors */
    --bg-primary: #f8f8f7;
    --bg-secondary: #ffffff;
    --text-primary: #1a1a1a;
    --text-secondary: #666666;
    --border-color: #e5e5e5;
    --shadow-color: rgba(0, 0, 0, 0.08);
    --pattern-opacity-base: 0.018;
    --pattern-opacity-light: 0.012;

    --font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
      Roboto, sans-serif;
    --font-family-heading: Garamond, "EB Garamond", "Apple Garamond", "ITC Garamond", Georgia, serif;

    --font-size-xs: 0.75rem;
    --font-size-sm: 0.875rem;
    --font-size-base: 1rem;
    --font-size-lg: 1.125rem;
    --font-size-xl: 1.25rem;
    --font-size-2xl: 1.5rem;
    --font-size-3xl: 2rem;
    --font-size-4xl: 2.5rem;
    --font-size-5xl: 3.5rem;

    --spacing-xs: 0.5rem;
    --spacing-sm: 1rem;
    --spacing-md: 1.5rem;
    --spacing-lg: 2.5rem;
    --spacing-xl: 3.5rem;
    --spacing-2xl: 5rem;
    --spacing-3xl: 7rem;
    --spacing-4xl: 10rem;
    --spacing-5xl: 12rem;

    --max-width: 72rem;
    --content-width: 48rem;

    --transition-fast: 150ms ease;
    --transition-base: 250ms ease;
    --transition-slow: 400ms ease;
  }

  /* Dark mode colors */
  [data-theme="dark"] {
    --bg-primary: #1a1a1a;
    --bg-secondary: #232323;
    --text-primary: #e8e8e8;
    --text-secondary: #a0a0a0;
    --border-color: #404040;
    --shadow-color: rgba(0, 0, 0, 0.4);
    --pattern-opacity-base: 0.08;
    --pattern-opacity-light: 0.05;

    /* Inverted tones for dark mode */
    --color-white: #1a1a1a;
    --color-pure-white: #232323;
    --color-dark: #e8e8e8;
    --color-gray-dark: #d0d0d0;
    --color-gray: #a0a0a0;
    --color-gray-light: #707070;
    --color-gray-lighter: #404040;
    --color-black: #f0f0f0;
  }

  /* Detect system preference for initial theme */
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme]) {
      --bg-primary: #1a1a1a;
      --bg-secondary: #232323;
      --text-primary: #e8e8e8;
      --text-secondary: #a0a0a0;
      --border-color: #404040;
      --shadow-color: rgba(0, 0, 0, 0.4);
      --pattern-opacity-base: 0.08;
      --pattern-opacity-light: 0.05;
    }
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: var(--font-family);
    font-size: var(--font-size-base);
    line-height: 1.75;
    color: var(--text-primary);
    background-color: var(--bg-primary);
    transition: background-color 0.3s ease, color 0.3s ease;
    background-image: 
      /* Very subtle noise texture for matte effect */
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.008) 2px,
        rgba(0, 0, 0, 0.008) 4px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.006) 2px,
        rgba(0, 0, 0, 0.006) 4px
      );
    transition: background-color 0.3s ease;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    position: relative;
    overflow-x: hidden;
  }

  /* Background geometric pattern - always visible, matte editorial style */
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    transition: opacity 0.3s ease;
    background-image: 
      /* Large cut-out squares - editorial style */
      linear-gradient(to right, transparent 0%, transparent 20%, rgba(255, 255, 255, var(--pattern-opacity-base)) 20%, rgba(255, 255, 255, var(--pattern-opacity-base)) 40%, transparent 40%),
      linear-gradient(to bottom, transparent 0%, transparent 15%, rgba(255, 255, 255, var(--pattern-opacity-light)) 15%, rgba(255, 255, 255, var(--pattern-opacity-light)) 35%, transparent 35%),
      /* Smaller accent squares */
      radial-gradient(circle at 85% 25%, rgba(255, 255, 255, calc(var(--pattern-opacity-base) + 0.004)) 0%, rgba(255, 255, 255, calc(var(--pattern-opacity-base) + 0.004)) 8%, transparent 8%),
      radial-gradient(circle at 10% 70%, rgba(255, 255, 255, var(--pattern-opacity-base)) 0%, rgba(255, 255, 255, var(--pattern-opacity-base)) 12%, transparent 12%),
      /* Subtle grid */
      linear-gradient(90deg, transparent 0%, transparent calc(100% - 1px), rgba(255, 255, 255, var(--pattern-opacity-light)) calc(100% - 1px)),
      linear-gradient(0deg, transparent 0%, transparent calc(100% - 1px), rgba(255, 255, 255, var(--pattern-opacity-light)) calc(100% - 1px));
    background-size: 
      100% 100%,
      100% 100%,
      600px 600px,
      800px 800px,
      150px 150px,
      150px 150px;
    background-position: 
      -10% -5%,
      5% 10%,
      0 0,
      0 0,
      0 0,
      0 0;
  }

  /* In light mode, use darker overlay */
  [data-theme="light"] body::before {
    background-image: 
      linear-gradient(to right, transparent 0%, transparent 20%, rgba(0, 0, 0, 0.018) 20%, rgba(0, 0, 0, 0.018) 40%, transparent 40%),
      linear-gradient(to bottom, transparent 0%, transparent 15%, rgba(0, 0, 0, 0.012) 15%, rgba(0, 0, 0, 0.012) 35%, transparent 35%),
      radial-gradient(circle at 85% 25%, rgba(0, 0, 0, 0.022) 0%, rgba(0, 0, 0, 0.022) 8%, transparent 8%),
      radial-gradient(circle at 10% 70%, rgba(0, 0, 0, 0.018) 0%, rgba(0, 0, 0, 0.018) 12%, transparent 12%),
      linear-gradient(90deg, transparent 0%, transparent calc(100% - 1px), rgba(0, 0, 0, 0.012) calc(100% - 1px)),
      linear-gradient(0deg, transparent 0%, transparent calc(100% - 1px), rgba(0, 0, 0, 0.012) calc(100% - 1px));
  }

  /* Additional cut-out square accents - matte tone-on-tone */
  body::after {
    content: "";
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    transition: opacity 0.3s ease;
    background-image:
      /* Top-right square partially visible */
      linear-gradient(to left, rgba(255, 255, 255, calc(var(--pattern-opacity-light) + 0.003)) 0%, rgba(255, 255, 255, calc(var(--pattern-opacity-light) + 0.003)) 15%, transparent 15%),
      linear-gradient(to bottom, rgba(255, 255, 255, calc(var(--pattern-opacity-light) + 0.003)) 0%, rgba(255, 255, 255, calc(var(--pattern-opacity-light) + 0.003)) 20%, transparent 20%),
      /* Bottom-left accent */
      linear-gradient(to right, rgba(255, 255, 255, var(--pattern-opacity-base)) 0%, rgba(255, 255, 255, var(--pattern-opacity-base)) 12%, transparent 12%),
      linear-gradient(to top, rgba(255, 255, 255, var(--pattern-opacity-light)) 0%, rgba(255, 255, 255, var(--pattern-opacity-light)) 18%, transparent 18%);
    background-size: 
      100% 100%,
      100% 100%,
      100% 100%,
      100% 100%;
    background-position: 
      0 0,
      0 0,
      0 100%,
      0 100%;
  }

  /* In light mode, use darker overlay */
  [data-theme="light"] body::after {
    background-image:
      linear-gradient(to left, rgba(0, 0, 0, 0.015) 0%, rgba(0, 0, 0, 0.015) 15%, transparent 15%),
      linear-gradient(to bottom, rgba(0, 0, 0, 0.015) 0%, rgba(0, 0, 0, 0.015) 20%, transparent 20%),
      linear-gradient(to right, rgba(0, 0, 0, 0.018) 0%, rgba(0, 0, 0, 0.018) 12%, transparent 12%),
      linear-gradient(to top, rgba(0, 0, 0, 0.012) 0%, rgba(0, 0, 0, 0.012) 18%, transparent 18%);
  }

  body > * {
    position: relative;
    z-index: 1;
  }

  img {
    max-width: 100%;
    height: auto;
    display: block;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  ul,
  ol {
    list-style: none;
  }

  /* Fade-in animation for sections */
  .section-animate {
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    will-change: opacity, transform;
  }

  .section-animate.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Variant: Slide from left */
  .reveal-left {
    opacity: 0;
    transform: translateX(-40px);
    transition:
      opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    will-change: opacity, transform;
  }

  .reveal-left.is-visible {
    opacity: 1;
    transform: translateX(0);
  }

  /* Variant: Slide from right */
  .reveal-right {
    opacity: 0;
    transform: translateX(40px);
    transition:
      opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    will-change: opacity, transform;
  }

  .reveal-right.is-visible {
    opacity: 1;
    transform: translateX(0);
  }

  /* Variant: Scale up */
  .reveal-scale {
    opacity: 0;
    transform: scale(0.95);
    transition:
      opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    will-change: opacity, transform;
  }

  .reveal-scale.is-visible {
    opacity: 1;
    transform: scale(1);
  }

  /* Staggered animation delays for child elements */
  .section-animate[data-delay="1"] {
    transition-delay: 0.1s;
  }

  .section-animate[data-delay="2"] {
    transition-delay: 0.2s;
  }

  .section-animate[data-delay="3"] {
    transition-delay: 0.3s;
  }

  .section-animate[data-delay="4"] {
    transition-delay: 0.4s;
  }

  /* Subtle link underline animation */
  .link-hover {
    position: relative;
    display: inline-block;
  }

  .link-hover::after {
    content: "";
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 1px;
    background-color: currentColor;
    transition: width 0.3s ease;
  }

  .link-hover:hover::after,
  .link-hover:focus::after {
    width: 100%;
  }

  /* Focus styles for accessibility */
  :focus-visible {
    outline: 2px solid var(--color-gray-dark);
    outline-offset: 2px;
  }

  /* Selection styles */
  ::selection {
    background-color: var(--text-primary);
    color: var(--bg-primary);
  }
</style>

<script>
  // Intersection Observer pour animations de révélation au scroll
  const createScrollObserver = () => {
    const observerOptions = {
      root: null,
      rootMargin: "-50px 0px -50px 0px",
      threshold: 0.15,
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          
          // Performance: arrêter d'observer après animation
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Observer tous les éléments avec classes d'animation
    const animatedElements = document.querySelectorAll(
      ".section-animate, .reveal-left, .reveal-right, .reveal-scale"
    );
    
    animatedElements.forEach((element) => {
      observer.observe(element);
    });
  };

  // Initialiser au chargement et lors de navigations côté client
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", createScrollObserver);
  } else {
    createScrollObserver();
  }

  // Support pour les navigations Astro (View Transitions)
  document.addEventListener("astro:page-load", createScrollObserver);
</script>
